FROM openjdk:8-jdk-alpine
RUN apk update && apk upgrade && apk add maven

COPY ./pom.xml .
RUN mvn clean install

ARG CRISPY_CHAT_API_CHECK_UTL=http://localhost:8080/oauth/check_token
ARG CRISPY_CHAT_API_CLIENT_ID=first-client
ARG CRISPY_CHAT_API_CLIENT_SECRET=noonewilleverguess
ARG CRISPY_CHAT_API_DB_URL=localhost:5432/main
ARG CRISPY_CHAT_API_DB_USERNAME=dbuser
ARG CRISPY_CHAT_API_DB_PASSWORD=dbpassword

ENV CRISPY_CHAT_API_CHECK_UTL $CRISPY_CHAT_API_CHECK_UTL
ENV CRISPY_CHAT_API_CLIENT_ID $CRISPY_CHAT_API_CLIENT_ID
ENV CRISPY_CHAT_API_CLIENT_SECRET $CRISPY_CHAT_API_CLIENT_SECRET
ENV CRISPY_CHAT_API_DB_URL $CRISPY_CHAT_API_DB_URL
ENV CRISPY_CHAT_API_DB_USERNAME $CRISPY_CHAT_API_DB_USERNAME
ENV CRISPY_CHAT_API_DB_PASSWORD $CRISPY_CHAT_API_DB_PASSWORD

COPY . .
ENTRYPOINT mvn spring-boot:run
EXPOSE 8081